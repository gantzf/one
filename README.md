# Проект Docker-сервера с настройкой Fail2Ban, Pi-hole, WireGuard и обратного прокси

Этот проект предназначен для создания безопасного Docker-сервера с настройкой для работы с несколькими сервисами, включая Pi-hole, WireGuard, Fail2Ban и обратное прокси через Nginx. Проект использует Docker Compose для быстрого развертывания и настройки сервисов.

### Архитектура проекта

В следующей схеме представлено, как взаимодействуют основные компоненты системы:

```
{3x-ui_public_port - panel + subs (vless(443) + external_proxy_own_publicIP + decoy_own_site)} 
=> {Cloudflare_proxy (rule_rewrite_uri path_rewrite_port)} 
=> Все работает на порту 443, скрыто за Cloudflare

{Nginx_proxy_publicPort = pihole + decoy + portainer + amnezia-wg} 
=> {Cloudflare_proxy (rule_rewrite_port)} 
=> Все работает на порту 443, скрыто за Cloudflare
```

## Требования

1. **Приобретение домена**: Для начала работы необходимо приобрести домен и перенести его на Cloudflare.
2. **Настройка сертификатов**: Первым делом нужно запустить команду `docker-compose up acme`, чтобы получить SSL-сертификаты для вашего домена.
3. После того как удостоверитесь, что сертификаты успешно получены, можно запускать весь проект командой `docker-compose up -d`.

> **Примечание**: Для настройки домена был выбран Cloudflare, так как он идеально решает проблему с нестандартными портами в адресной строке и предоставляет оптимальное решение для управления SSL-сертификатами. Cloudflare эффективно работает с безопасными соединениями, гарантируя надежное шифрование и упрощенную настройку.

> **План на будущее**: В дальнейшем планируется заменить ACME и Nginx на Traefik для более гибкой и удобной настройки маршрутизации трафика и управления сертификатами.

## Структура проекта

Проект состоит из следующих сервисов:

1. **3x-ui**: Интерфейс для управления Xray.
2. **Nginx Proxy**: Обратный прокси для обслуживания веб-трафика.
3. **Pi-hole**: Решение для блокировки рекламы и трекеров.
4. **Unbound**: DNS-сервер для обеспечения безопасности и конфиденциальности.
5. **Portainer**: Веб-интерфейс для управления Docker-контейнерами.
6. **Amnezia WireGuard**: Простой интерфейс для настройки WireGuard VPN.
7. **Acme**: Контейнер для получения SSL-сертификатов через Let's Encrypt.

## Установка и запуск

1. Убедитесь, что у вас установлен Docker и Docker Compose.
2. Клонируйте репозиторий с проектом:

   ```bash
   git clone https://github.com/gantzf/one.git
   cd one
   ```

3. Создайте файл `.env` для настройки переменных окружения (для Pi-hole, ACME и других сервисов).

4. Запустите контейнер для получения SSL-сертификатов:

   ```bash
   docker-compose up acme
   ```

   Подождите, пока сертификаты будут получены и установлены в указанный путь.

5. После успешного получения сертификатов запустите все сервисы:

   ```bash
   docker-compose up -d
   ```

6. Теперь все сервисы работают, и вы можете подключаться к ним через домен, настроенный в Cloudflare.

## Описание сервисов

### 1. **3x-ui**
Этот сервис предоставляет интерфейс для управления Xray. Он позволяет настроить прокси, используя Xray и предоставляет удобный интерфейс для пользователей.

- **Порт**: Доступ через `https://example.com:6443`
- **Настройки**: Хранятся в `./3x-ui/db/` и в папке с сертификатами `./acme/certs`.

### 2. **Nginx Proxy**
Nginx работает как обратный прокси для обработки входящих запросов и перенаправления их на соответствующие контейнеры, такие как 3x-ui.

- **Порты**: Открывает порты для HTTPS (443).
- **Настройки**: Конфигурация находится в `./nginx_proxy/conf.d`.

### 3. **Pi-hole**
Pi-hole — это блокировщик рекламы и трекеров, который работает как DNS-сервер.

- **Порты**: Порты DNS (53) перенаправляются на локальный интерфейс.
- **Сетевые настройки**: Использует контейнеры с настроенной сетью `dns_net`.

### 4. **Unbound**
Unbound — это DNS-сервер, который работает вместе с Pi-hole для обеспечения безопасности и производительности запросов DNS.

### 5. **Portainer**
Portainer — это веб-интерфейс для управления Docker-контейнерами. Позволяет удобно управлять контейнерами, следить за состоянием и логами.

### 6. **Amnezia WireGuard**
Amnezia WireGuard — это интерфейс для настройки и управления WireGuard VPN. Обеспечивает безопасное соединение для удаленной работы.

### 7. **Acme**
Контейнер, который использует ACME.sh для получения SSL-сертификатов от Let's Encrypt и их установки в контейнеры.

## Заключение

Этот проект обеспечивает безопасное и удобное решение для блокировки рекламы, управления VPN-соединениями, получения SSL-сертификатов и настройки обратного прокси. Он использует современные инструменты и контейнеризацию для упрощения работы с сервером. В будущем будет добавлена поддержка Traefik для более удобной и гибкой маршрутизации трафика.
